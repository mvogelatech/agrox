{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/jmgoncalves/git/agro-x/frontend/components/20-quotations/price-selection.tsx\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useRef } from 'react';\nimport { dispatch, useMainSelector } from \"../../redux-things\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport { createTStyleSheet } from \"../../src/utils/style\";\nimport { asAliveOnlyScreenComponent } from \"../../src/utils/smart-lifecycle-components\";\nimport { userDidNotSelectPaymentMethod, asyncCancelableAlert } from \"../../src/utils/alert-messages\";\nimport { BackHeader } from \"../00-common/back-header\";\nimport { PulverizationMethods } from \"../../models\";\nimport { formatDate, getLatestDiagnosis, scrollToEndAndBack } from \"../../src/utils\";\nimport { QuotationMethod } from \"./quotation-method\";\nimport { images } from \"../../src/assets\";\nimport { Divider, RadioButton, FAB } from 'react-native-paper';\nimport { Accordion } from \"../00-common\";\nimport { PriceSelector } from \"./price-selector\";\nimport dayjs from 'dayjs';\n\nfunction haversineDistance(lat1, long1, lat2, long2) {\n  var R = 6371e3;\n  var φ1 = lat1 * Math.PI / 180;\n  var φ2 = lat2 * Math.PI / 180;\n  var Δφ = (lat2 - lat1) * Math.PI / 180;\n  var Δλ = (long2 - long1) * Math.PI / 180;\n  var a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  var d = R * c;\n  return (d / 1000).toFixed(0);\n}\n\nexport var PriceSelection = asAliveOnlyScreenComponent(function (_ref) {\n  var navigation = _ref.navigation,\n      route = _ref.route;\n  var farm = useMainSelector(function (state) {\n    return state.backendData.user.many_user_has_many_farm[0].farm;\n  });\n  var planeFields = [];\n  var droneFields = [];\n  route.params.quotationPackage.quotation_modal_package.map(function (modal) {\n    return modal.field.forEach(function (field) {\n      return modal.pulverization_method === PulverizationMethods.DRONE ? droneFields.push(field) : planeFields.push(field);\n    });\n  });\n\n  var _React$useState = React.useState(new Set()),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      expandedAccordions = _React$useState2[0],\n      setExpandedAccordions = _React$useState2[1];\n\n  var _React$useState3 = React.useState(undefined),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      dronePaymentMethod = _React$useState4[0],\n      setDronePaymentMethod = _React$useState4[1];\n\n  var _React$useState5 = React.useState(undefined),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      droneQuotation = _React$useState6[0],\n      setDroneQuotation = _React$useState6[1];\n\n  var _React$useState7 = React.useState(undefined),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      planePaymentMethod = _React$useState8[0],\n      setPlanePaymentMethod = _React$useState8[1];\n\n  var _React$useState9 = React.useState(undefined),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      planeQuotation = _React$useState10[0],\n      setPlaneQuotation = _React$useState10[1];\n\n  function CompaniesAccordion(props) {\n    var _props$quotation$expi;\n\n    function setSelection(method) {\n      if (props.modal === PulverizationMethods.DRONE) {\n        if (method === dronePaymentMethod) {\n          setDroneQuotation(undefined);\n          setDronePaymentMethod(undefined);\n        } else {\n          setDroneQuotation(props.quotation);\n          setDronePaymentMethod(method);\n        }\n      } else if (method === planePaymentMethod) {\n        setPlaneQuotation(undefined);\n        setPlanePaymentMethod(undefined);\n      } else {\n        setPlaneQuotation(props.quotation);\n        setPlanePaymentMethod(method);\n      }\n    }\n\n    var isChosen = false;\n\n    if (props.modal === PulverizationMethods.DRONE) {\n      if (props.quotation === droneQuotation) isChosen = true;\n    } else if (props.quotation === planeQuotation) isChosen = true;\n\n    return React.createElement(Accordion, {\n      key: props.quotation.company.name.toString(),\n      isExpanded: expandedAccordions.has(props.modal + \"_\" + props.quotation.company.name),\n      title: props.quotation.company.name,\n      subtitle: haversineDistance(farm.lat, farm.long, props.quotation.company.lat, props.quotation.company.long) + \" km de dist\\xE2ncia\",\n      divider: React.createElement(Divider, {\n        style: styles.mainDivider,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 14\n        }\n      }),\n      titleRight: isChosen ? React.createElement(Text, {\n        style: styles.recommendedText,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 28\n        }\n      }, \"ESCOLHIDO\") : undefined,\n      onPress: function onPress() {\n        setExpandedAccordions(function (expandedAccordions) {\n          if (expandedAccordions.has(props.modal + \"_\" + props.quotation.company.name)) expandedAccordions.delete(props.modal + \"_\" + props.quotation.company.name);else expandedAccordions.add(props.modal + \"_\" + props.quotation.company.name);\n          return new Set(expandedAccordions);\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 4\n      }\n    }, React.createElement(View, {\n      style: styles.accordionContentView,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 5\n      }\n    }, React.createElement(PriceSelector, {\n      method: \"antecipated_price\",\n      quotation: props.quotation,\n      onPress: setSelection,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 6\n      }\n    }), React.createElement(Divider, {\n      style: styles.mainDivider,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 6\n      }\n    }), React.createElement(PriceSelector, {\n      method: \"cash_price\",\n      quotation: props.quotation,\n      onPress: setSelection,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 6\n      }\n    }), React.createElement(Divider, {\n      style: styles.mainDivider,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 6\n      }\n    }), React.createElement(PriceSelector, {\n      method: \"delayed_price\",\n      quotation: props.quotation,\n      onPress: setSelection,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 6\n      }\n    }), React.createElement(Divider, {\n      style: styles.mainDivider,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 6\n      }\n    }), React.createElement(Text, {\n      style: styles.expiration,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 6\n      }\n    }, \"Or\\xE7amento v\\xE1lido at\\xE9: \", formatDate((_props$quotation$expi = props.quotation.expiration_date) != null ? _props$quotation$expi : dayjs().toISOString()))));\n  }\n\n  var scrollViewRef = useRef(null);\n  return React.createElement(View, {\n    style: styles.mainView,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 3\n    }\n  }, React.createElement(BackHeader, {\n    title: \"Or\\xE7amento \" + route.params.quotationPackage.code.toString(),\n    onBackPress: function onBackPress() {\n      return navigation.goBack();\n    },\n    onNotificationPress: function onNotificationPress() {\n      return navigation.navigate('Notifications');\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 4\n    }\n  }), React.createElement(ScrollView, {\n    ref: scrollViewRef,\n    style: styles.contentView,\n    onLayout: function onLayout() {\n      return scrollToEndAndBack(scrollViewRef, 'scrollview');\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 4\n    }\n  }, route.params.quotationPackage.quotation_modal_package.some(function (modal) {\n    return modal.pulverization_method === PulverizationMethods.DRONE;\n  }) ? React.createElement(View, {\n    style: styles.methodView,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 6\n    }\n  }, React.createElement(QuotationMethod, {\n    method: \"drone\",\n    isHideDetailsButton: !getLatestDiagnosis(droneFields[0]),\n    onDetailsPress: function onDetailsPress() {\n      navigation.navigate('Details', {\n        fields: droneFields,\n        method: PulverizationMethods.DRONE\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }\n  }), React.createElement(View, {\n    style: styles.logoView,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }\n  }, React.createElement(Text, {\n    style: styles.homologated,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 8\n    }\n  }, \"EMPRESAS HOMOLOGADAS\"), React.createElement(Image, {\n    source: images.croppedLogo,\n    resizeMode: \"contain\",\n    style: styles.logo,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 8\n    }\n  })), React.createElement(View, {\n    style: styles.accordionsView,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }\n  }, React.createElement(RadioButton.Group, {\n    value: droneQuotation && dronePaymentMethod ? droneQuotation.company_id + \"_\" + dronePaymentMethod : '',\n    onValueChange: function onValueChange() {\n      return console.log('');\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 8\n    }\n  }, route.params.quotationPackage.quotation_modal_package.map(function (modal) {\n    return modal.pulverization_method === PulverizationMethods.DRONE ? modal.quotation.map(function (quotation) {\n      return React.createElement(CompaniesAccordion, {\n        key: quotation.id.toString(),\n        quotation: quotation,\n        modal: PulverizationMethods.DRONE,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 20\n        }\n      });\n    }) : undefined;\n  })))) : undefined, route.params.quotationPackage.quotation_modal_package.some(function (modal) {\n    return modal.pulverization_method === PulverizationMethods.PLANE;\n  }) ? React.createElement(View, {\n    style: styles.methodView,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 6\n    }\n  }, React.createElement(QuotationMethod, {\n    method: \"plane\",\n    isHideDetailsButton: !getLatestDiagnosis(planeFields[0]),\n    onDetailsPress: function onDetailsPress() {\n      navigation.navigate('Details', {\n        fields: planeFields,\n        method: PulverizationMethods.PLANE\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }\n  }), React.createElement(View, {\n    style: styles.logoView,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }\n  }, React.createElement(Text, {\n    style: styles.homologated,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 8\n    }\n  }, \"EMPRESAS HOMOLOGADAS\"), React.createElement(Image, {\n    source: images.croppedLogo,\n    resizeMode: \"contain\",\n    style: styles.logo,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 8\n    }\n  })), React.createElement(View, {\n    style: styles.accordionsView,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }\n  }, React.createElement(RadioButton.Group, {\n    value: planeQuotation && planePaymentMethod ? planeQuotation.company_id + \"_\" + planePaymentMethod : '',\n    onValueChange: function onValueChange() {\n      return console.log('');\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 8\n    }\n  }, route.params.quotationPackage.quotation_modal_package.map(function (modal) {\n    return modal.pulverization_method === PulverizationMethods.PLANE ? modal.quotation.map(function (quotation) {\n      return React.createElement(CompaniesAccordion, {\n        key: quotation.id.toString(),\n        quotation: quotation,\n        modal: PulverizationMethods.PLANE,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 20\n        }\n      });\n    }) : undefined;\n  })))) : undefined), dronePaymentMethod || planePaymentMethod ? React.createElement(FAB, {\n    style: styles.fab,\n    label: \"CONTINUAR\",\n    icon: \"\",\n    onPress: function _callee() {\n      var droneSelected, planeSelected, response;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              droneSelected = droneQuotation && dronePaymentMethod;\n              planeSelected = planeQuotation && planePaymentMethod;\n\n              if (!(planeFields.length > 0 && !planeSelected || droneFields.length > 0 && !droneSelected)) {\n                _context.next = 9;\n                break;\n              }\n\n              userDidNotSelectPaymentMethod.body = \"Voc\\xEA n\\xE3o selecionou uma empresa para pulveriza\\xE7\\xE3o por \" + (planeSelected ? 'Drone' : 'Avião') + \".\\n\\nTem certeza que deseja prosseguir?\\n\\nEssa a\\xE7\\xE3o n\\xE3o poder\\xE1 ser desfeita.\";\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(asyncCancelableAlert(userDidNotSelectPaymentMethod));\n\n            case 6:\n              response = _context.sent;\n\n              if (!(response !== 'CONFIRM')) {\n                _context.next = 9;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 9:\n              dispatch({\n                type: 'SET_QUOTATION_CHECKOUT',\n                checkout: {\n                  droneCheckout: droneSelected ? {\n                    quotation: droneQuotation,\n                    paymentMethod: dronePaymentMethod\n                  } : undefined,\n                  planeCheckout: planeSelected ? {\n                    quotation: planeQuotation,\n                    paymentMethod: planePaymentMethod\n                  } : undefined,\n                  quotationPackage: route.params.quotationPackage\n                }\n              });\n              navigation.navigate('CheckoutConfirmation', {\n                quotationPackage: route.params.quotationPackage\n              });\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 5\n    }\n  }) : undefined);\n});\nvar styles = createTStyleSheet({\n  fab: {\n    position: 'absolute',\n    margin: '16rem',\n    right: 0,\n    bottom: 0\n  },\n  mainView: {\n    flex: 1,\n    backgroundColor: 'white'\n  },\n  methodView: {\n    paddingBottom: '64rem',\n    backgroundColor: 'white'\n  },\n  contentView: {\n    flex: 1\n  },\n  accordionsView: {\n    paddingHorizontal: '8rem'\n  },\n  accordionContentView: {\n    justifyContent: 'flex-start',\n    width: '100%',\n    paddingHorizontal: '8rem'\n  },\n  mainDivider: {\n    width: '100%',\n    height: '1rem'\n  },\n  logoView: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    paddingVertical: '24rem'\n  },\n  $logoSize: '110rem',\n  logo: {\n    width: '$logoSize',\n    height: '$logoSize/4',\n    tintColor: '#327387'\n  },\n  homologated: {\n    fontSize: '11rem',\n    color: '#78849E',\n    marginRight: '16rem'\n  },\n  subtitle: {\n    fontSize: '16rem',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  subSubtitle: {\n    fontSize: '10rem',\n    alignItems: 'center',\n    justifyContent: 'center',\n    color: '#78849E'\n  },\n  expiration: {\n    marginTop: '8rem',\n    fontSize: '13rem',\n    fontStyle: 'italic'\n  },\n  recommendedText: {\n    paddingVertical: '2rem',\n    paddingHorizontal: '6rem',\n    fontSize: '9.5rem',\n    backgroundColor: '#469BA2',\n    fontWeight: 'bold',\n    borderRadius: '6rem',\n    color: 'white'\n  }\n});","map":{"version":3,"sources":["/home/jmgoncalves/git/agro-x/frontend/components/20-quotations/price-selection.tsx"],"names":["React","useRef","dispatch","useMainSelector","createTStyleSheet","asAliveOnlyScreenComponent","userDidNotSelectPaymentMethod","asyncCancelableAlert","BackHeader","PulverizationMethods","formatDate","getLatestDiagnosis","scrollToEndAndBack","QuotationMethod","images","Divider","RadioButton","FAB","Accordion","PriceSelector","dayjs","haversineDistance","lat1","long1","lat2","long2","R","φ1","Math","PI","φ2","Δφ","Δλ","a","sin","cos","c","atan2","sqrt","d","toFixed","PriceSelection","navigation","route","farm","state","backendData","user","many_user_has_many_farm","planeFields","droneFields","params","quotationPackage","quotation_modal_package","map","modal","field","forEach","pulverization_method","DRONE","push","useState","Set","expandedAccordions","setExpandedAccordions","undefined","dronePaymentMethod","setDronePaymentMethod","droneQuotation","setDroneQuotation","planePaymentMethod","setPlanePaymentMethod","planeQuotation","setPlaneQuotation","CompaniesAccordion","props","setSelection","method","quotation","isChosen","company","name","toString","has","lat","long","styles","mainDivider","recommendedText","delete","add","accordionContentView","expiration","expiration_date","toISOString","scrollViewRef","mainView","code","goBack","navigate","contentView","some","methodView","fields","logoView","homologated","croppedLogo","logo","accordionsView","company_id","console","log","id","PLANE","fab","droneSelected","planeSelected","length","body","response","type","checkout","droneCheckout","paymentMethod","planeCheckout","position","margin","right","bottom","flex","backgroundColor","paddingBottom","paddingHorizontal","justifyContent","width","height","flexDirection","alignItems","paddingVertical","$logoSize","tintColor","fontSize","color","marginRight","subtitle","subSubtitle","marginTop","fontStyle","fontWeight","borderRadius"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport { dispatch, useMainSelector } from '../../redux-things';\n\nimport { View, Image, Text, ScrollView } from 'react-native';\nimport { createTStyleSheet } from '../../src/utils/style';\nimport { asAliveOnlyScreenComponent } from '../../src/utils/smart-lifecycle-components';\n\nimport { AgroXScreenProps } from '../navigation-types';\nimport { userDidNotSelectPaymentMethod, asyncCancelableAlert } from '../../src/utils/alert-messages';\nimport { BackHeader } from '../00-common/back-header';\nimport { Models, PulverizationMethods, PulverizationMethod, PaymentMethod } from '../../models';\nimport { formatDate, getLatestDiagnosis, scrollToEndAndBack } from '../../src/utils';\nimport { QuotationMethod } from './quotation-method';\nimport { images } from '../../src/assets';\nimport { Divider, RadioButton, FAB } from 'react-native-paper';\nimport { Accordion } from '../00-common';\nimport { PriceSelector } from './price-selector';\nimport dayjs from 'dayjs';\n\nfunction haversineDistance(lat1: number, long1: number, lat2: number, long2: number) {\n\tconst R = 6371e3; // meters\n\tconst φ1 = (lat1 * Math.PI) / 180; // φ, λ in radians\n\tconst φ2 = (lat2 * Math.PI) / 180;\n\tconst Δφ = ((lat2 - lat1) * Math.PI) / 180;\n\tconst Δλ = ((long2 - long1) * Math.PI) / 180;\n\n\tconst a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\n\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n\tconst d = R * c; // in meters\n\treturn (d / 1000).toFixed(0);\n}\n\nexport const PriceSelection = asAliveOnlyScreenComponent(({ navigation, route }: AgroXScreenProps<'PriceSelection'>) => {\n\tconst farm = useMainSelector((state) => state.backendData.user!.many_user_has_many_farm[0].farm)!;\n\n\tconst planeFields: Models.field[] = [];\n\tconst droneFields: Models.field[] = [];\n\n\troute.params.quotationPackage.quotation_modal_package.map((modal) =>\n\t\tmodal.field.forEach((field) => (modal.pulverization_method === PulverizationMethods.DRONE ? droneFields.push(field) : planeFields.push(field))),\n\t);\n\n\tconst [expandedAccordions, setExpandedAccordions] = React.useState(new Set());\n\n\tconst [dronePaymentMethod, setDronePaymentMethod] = React.useState<PaymentMethod>(undefined);\n\tconst [droneQuotation, setDroneQuotation] = React.useState<Models.quotation | undefined>(undefined);\n\n\tconst [planePaymentMethod, setPlanePaymentMethod] = React.useState<PaymentMethod>(undefined);\n\tconst [planeQuotation, setPlaneQuotation] = React.useState<Models.quotation | undefined>(undefined);\n\n\tfunction CompaniesAccordion(props: { quotation: Models.quotation; modal: PulverizationMethod }) {\n\t\tfunction setSelection(method: PaymentMethod) {\n\t\t\tif (props.modal === PulverizationMethods.DRONE) {\n\t\t\t\tif (method === dronePaymentMethod) {\n\t\t\t\t\tsetDroneQuotation(undefined);\n\t\t\t\t\tsetDronePaymentMethod(undefined);\n\t\t\t\t} else {\n\t\t\t\t\tsetDroneQuotation(props.quotation);\n\t\t\t\t\tsetDronePaymentMethod(method);\n\t\t\t\t}\n\t\t\t} else if (method === planePaymentMethod) {\n\t\t\t\tsetPlaneQuotation(undefined);\n\t\t\t\tsetPlanePaymentMethod(undefined);\n\t\t\t} else {\n\t\t\t\tsetPlaneQuotation(props.quotation);\n\t\t\t\tsetPlanePaymentMethod(method);\n\t\t\t}\n\t\t}\n\n\t\tlet isChosen = false;\n\t\tif (props.modal === PulverizationMethods.DRONE) {\n\t\t\tif (props.quotation === droneQuotation) isChosen = true;\n\t\t} else if (props.quotation === planeQuotation) isChosen = true;\n\n\t\treturn (\n\t\t\t<Accordion\n\t\t\t\tkey={props.quotation.company.name.toString()}\n\t\t\t\tisExpanded={expandedAccordions.has(`${props.modal}_${props.quotation.company.name}`)}\n\t\t\t\ttitle={props.quotation.company.name}\n\t\t\t\t// TODO: Change here to be the smallest distance\n\t\t\t\tsubtitle={`${haversineDistance(farm.lat, farm.long, props.quotation.company.lat, props.quotation.company.long)} km de distância`}\n\t\t\t\tdivider={<Divider style={styles.mainDivider} />}\n\t\t\t\ttitleRight={isChosen ? <Text style={styles.recommendedText}>ESCOLHIDO</Text> : undefined}\n\t\t\t\tonPress={() => {\n\t\t\t\t\tsetExpandedAccordions((expandedAccordions) => {\n\t\t\t\t\t\tif (expandedAccordions.has(`${props.modal}_${props.quotation.company.name}`))\n\t\t\t\t\t\t\texpandedAccordions.delete(`${props.modal}_${props.quotation.company.name}`);\n\t\t\t\t\t\telse expandedAccordions.add(`${props.modal}_${props.quotation.company.name}`);\n\t\t\t\t\t\treturn new Set(expandedAccordions);\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<View style={styles.accordionContentView}>\n\t\t\t\t\t<PriceSelector method=\"antecipated_price\" quotation={props.quotation} onPress={setSelection} />\n\t\t\t\t\t<Divider style={styles.mainDivider} />\n\t\t\t\t\t<PriceSelector method=\"cash_price\" quotation={props.quotation} onPress={setSelection} />\n\t\t\t\t\t<Divider style={styles.mainDivider} />\n\t\t\t\t\t<PriceSelector method=\"delayed_price\" quotation={props.quotation} onPress={setSelection} />\n\t\t\t\t\t<Divider style={styles.mainDivider} />\n\t\t\t\t\t<Text style={styles.expiration}>Orçamento válido até: {formatDate(props.quotation.expiration_date ?? dayjs().toISOString())}</Text>\n\t\t\t\t</View>\n\t\t\t</Accordion>\n\t\t);\n\t}\n\n\tconst scrollViewRef = useRef<ScrollView>(null);\n\treturn (\n\t\t<View style={styles.mainView}>\n\t\t\t<BackHeader\n\t\t\t\ttitle={`Orçamento ${route.params.quotationPackage.code.toString()}`}\n\t\t\t\tonBackPress={() => navigation.goBack()}\n\t\t\t\tonNotificationPress={() => navigation.navigate('Notifications')}\n\t\t\t/>\n\t\t\t<ScrollView ref={scrollViewRef} style={styles.contentView} onLayout={() => scrollToEndAndBack(scrollViewRef, 'scrollview')}>\n\t\t\t\t{route.params.quotationPackage.quotation_modal_package.some((modal) => modal.pulverization_method === PulverizationMethods.DRONE) ? (\n\t\t\t\t\t<View style={styles.methodView}>\n\t\t\t\t\t\t<QuotationMethod\n\t\t\t\t\t\t\tmethod=\"drone\"\n\t\t\t\t\t\t\tisHideDetailsButton={!getLatestDiagnosis(droneFields[0])}\n\t\t\t\t\t\t\tonDetailsPress={() => {\n\t\t\t\t\t\t\t\tnavigation.navigate('Details', {\n\t\t\t\t\t\t\t\t\tfields: droneFields,\n\t\t\t\t\t\t\t\t\tmethod: PulverizationMethods.DRONE,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<View style={styles.logoView}>\n\t\t\t\t\t\t\t<Text style={styles.homologated}>EMPRESAS HOMOLOGADAS</Text>\n\t\t\t\t\t\t\t<Image source={images.croppedLogo} resizeMode=\"contain\" style={styles.logo} />\n\t\t\t\t\t\t</View>\n\t\t\t\t\t\t<View style={styles.accordionsView}>\n\t\t\t\t\t\t\t<RadioButton.Group\n\t\t\t\t\t\t\t\tvalue={droneQuotation && dronePaymentMethod ? `${droneQuotation.company_id}_${dronePaymentMethod}` : ''}\n\t\t\t\t\t\t\t\tonValueChange={() => console.log('')}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{route.params.quotationPackage.quotation_modal_package.map((modal) =>\n\t\t\t\t\t\t\t\t\tmodal.pulverization_method === PulverizationMethods.DRONE\n\t\t\t\t\t\t\t\t\t\t? modal.quotation.map((quotation) => {\n\t\t\t\t\t\t\t\t\t\t\t\treturn <CompaniesAccordion key={quotation.id.toString()} quotation={quotation} modal={PulverizationMethods.DRONE} />;\n\t\t\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</RadioButton.Group>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t</View>\n\t\t\t\t) : undefined}\n\n\t\t\t\t{route.params.quotationPackage.quotation_modal_package.some((modal) => modal.pulverization_method === PulverizationMethods.PLANE) ? (\n\t\t\t\t\t<View style={styles.methodView}>\n\t\t\t\t\t\t<QuotationMethod\n\t\t\t\t\t\t\tmethod=\"plane\"\n\t\t\t\t\t\t\tisHideDetailsButton={!getLatestDiagnosis(planeFields[0])}\n\t\t\t\t\t\t\tonDetailsPress={() => {\n\t\t\t\t\t\t\t\tnavigation.navigate('Details', {\n\t\t\t\t\t\t\t\t\tfields: planeFields,\n\t\t\t\t\t\t\t\t\tmethod: PulverizationMethods.PLANE,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<View style={styles.logoView}>\n\t\t\t\t\t\t\t<Text style={styles.homologated}>EMPRESAS HOMOLOGADAS</Text>\n\t\t\t\t\t\t\t<Image source={images.croppedLogo} resizeMode=\"contain\" style={styles.logo} />\n\t\t\t\t\t\t</View>\n\t\t\t\t\t\t<View style={styles.accordionsView}>\n\t\t\t\t\t\t\t<RadioButton.Group\n\t\t\t\t\t\t\t\tvalue={planeQuotation && planePaymentMethod ? `${planeQuotation.company_id}_${planePaymentMethod}` : ''}\n\t\t\t\t\t\t\t\tonValueChange={() => console.log('')}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{route.params.quotationPackage.quotation_modal_package.map((modal) =>\n\t\t\t\t\t\t\t\t\tmodal.pulverization_method === PulverizationMethods.PLANE\n\t\t\t\t\t\t\t\t\t\t? modal.quotation.map((quotation) => {\n\t\t\t\t\t\t\t\t\t\t\t\treturn <CompaniesAccordion key={quotation.id.toString()} quotation={quotation} modal={PulverizationMethods.PLANE} />;\n\t\t\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</RadioButton.Group>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t</View>\n\t\t\t\t) : undefined}\n\t\t\t</ScrollView>\n\t\t\t{dronePaymentMethod || planePaymentMethod ? (\n\t\t\t\t// eslint-disable-next-line  react/jsx-pascal-case\n\t\t\t\t<FAB\n\t\t\t\t\tstyle={styles.fab}\n\t\t\t\t\tlabel=\"CONTINUAR\"\n\t\t\t\t\ticon=\"\"\n\t\t\t\t\tonPress={async () => {\n\t\t\t\t\t\tconst droneSelected = droneQuotation && dronePaymentMethod;\n\t\t\t\t\t\tconst planeSelected = planeQuotation && planePaymentMethod;\n\n\t\t\t\t\t\tif ((planeFields.length > 0 && !planeSelected) || (droneFields.length > 0 && !droneSelected)) {\n\t\t\t\t\t\t\tuserDidNotSelectPaymentMethod.body = `Você não selecionou uma empresa para pulverização por ${\n\t\t\t\t\t\t\t\tplaneSelected ? 'Drone' : 'Avião'\n\t\t\t\t\t\t\t}.\\n\\nTem certeza que deseja prosseguir?\\n\\nEssa ação não poderá ser desfeita.`;\n\n\t\t\t\t\t\t\tconst response = await asyncCancelableAlert(userDidNotSelectPaymentMethod);\n\t\t\t\t\t\t\tif (response !== 'CONFIRM') {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdispatch({\n\t\t\t\t\t\t\ttype: 'SET_QUOTATION_CHECKOUT',\n\t\t\t\t\t\t\tcheckout: {\n\t\t\t\t\t\t\t\tdroneCheckout: droneSelected ? { quotation: droneQuotation!, paymentMethod: dronePaymentMethod! } : undefined,\n\t\t\t\t\t\t\t\tplaneCheckout: planeSelected ? { quotation: planeQuotation!, paymentMethod: planePaymentMethod! } : undefined,\n\t\t\t\t\t\t\t\tquotationPackage: route.params.quotationPackage,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tnavigation.navigate('CheckoutConfirmation', {\n\t\t\t\t\t\t\tquotationPackage: route.params.quotationPackage,\n\t\t\t\t\t\t});\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t) : undefined}\n\t\t</View>\n\t);\n});\n\nconst styles = createTStyleSheet({\n\tfab: {\n\t\tposition: 'absolute',\n\t\tmargin: '16rem',\n\t\tright: 0,\n\t\tbottom: 0,\n\t},\n\tmainView: {\n\t\tflex: 1,\n\t\tbackgroundColor: 'white',\n\t},\n\tmethodView: {\n\t\tpaddingBottom: '64rem',\n\t\tbackgroundColor: 'white',\n\t},\n\tcontentView: {\n\t\tflex: 1,\n\t},\n\taccordionsView: {\n\t\tpaddingHorizontal: '8rem',\n\t},\n\taccordionContentView: {\n\t\tjustifyContent: 'flex-start',\n\t\twidth: '100%',\n\t\tpaddingHorizontal: '8rem',\n\t},\n\tmainDivider: {\n\t\twidth: '100%',\n\t\theight: '1rem',\n\t},\n\tlogoView: {\n\t\tflexDirection: 'row',\n\t\talignItems: 'center',\n\t\tjustifyContent: 'center',\n\t\tpaddingVertical: '24rem',\n\t},\n\t$logoSize: '110rem',\n\tlogo: {\n\t\twidth: '$logoSize',\n\t\theight: '$logoSize/4',\n\t\ttintColor: '#327387',\n\t},\n\thomologated: {\n\t\tfontSize: '11rem',\n\t\tcolor: '#78849E',\n\t\tmarginRight: '16rem',\n\t},\n\tsubtitle: {\n\t\tfontSize: '16rem',\n\t\talignItems: 'center',\n\t\tjustifyContent: 'center',\n\t},\n\tsubSubtitle: {\n\t\tfontSize: '10rem',\n\t\talignItems: 'center',\n\t\tjustifyContent: 'center',\n\t\tcolor: '#78849E',\n\t},\n\texpiration: {\n\t\tmarginTop: '8rem',\n\t\tfontSize: '13rem',\n\t\tfontStyle: 'italic',\n\t},\n\trecommendedText: {\n\t\tpaddingVertical: '2rem',\n\t\tpaddingHorizontal: '6rem',\n\t\tfontSize: '9.5rem',\n\t\tbackgroundColor: '#469BA2',\n\t\tfontWeight: 'bold',\n\t\tborderRadius: '6rem',\n\t\tcolor: 'white',\n\t},\n});\n"]},"metadata":{},"sourceType":"module"}