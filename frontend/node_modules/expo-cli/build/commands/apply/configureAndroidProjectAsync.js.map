{"version":3,"sources":["../../../src/commands/apply/configureAndroidProjectAsync.ts"],"names":["modifyBuildGradleAsync","projectRoot","callback","buildGradlePath","AndroidConfig","Paths","getAndroidBuildGradle","buildGradleString","fs","readFileSync","toString","result","writeFileSync","modifyAppBuildGradleAsync","getAppBuildGradle","modifyAndroidManifestAsync","androidManifestPath","getAndroidManifestAsync","androidManifestJSON","Manifest","readAndroidManifestAsync","writeAndroidManifestAsync","modifyMainActivityAsync","mainActivity","getMainActivityAsync","contents","path","language","configureAndroidProjectAsync","exp","skipSDKVersionRequirement","username","process","env","EAS_BUILD_USERNAME","UserManager","getCurrentUsernameAsync","buildGradle","GoogleServices","setClassPath","applyPlugin","Package","setPackageInBuildGradle","Version","setVersionCode","setVersionName","androidManifest","setPackageInAndroidManifest","AllowBackup","setAllowBackup","Scheme","setScheme","Orientation","setAndroidOrientation","Permissions","setAndroidPermissions","Branch","setBranchApiKey","Facebook","setFacebookConfig","UserInterfaceStyle","setUiModeAndroidManifest","GoogleMobileAds","setGoogleMobileAdsConfig","GoogleMapsApiKey","setGoogleMapsApiKey","IntentFilters","setAndroidIntentFilters","Updates","setUpdatesConfig","addOnConfigurationChangedMainActivity","WarningAggregator","addWarningAndroid","renamePackageOnDisk","RootViewBackgroundColor","setRootViewBackgroundColor","NavigationBar","setNavigationBarConfig","StatusBar","setStatusBarConfig","PrimaryColor","setPrimaryColor","setFacebookAppIdString","Name","setName","setGoogleServicesFile","SplashScreen","setSplashScreenAsync","Icon","setIconAsync"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEA,eAAeA,sBAAf,CACEC,WADF,EAEEC,QAFF,EAGE;AACA,QAAMC,eAAe,GAAGC,wBAAcC,KAAd,CAAoBC,qBAApB,CAA0CL,WAA1C,CAAxB;;AACA,QAAMM,iBAAiB,GAAGC,mBAAGC,YAAH,CAAgBN,eAAhB,EAAiCO,QAAjC,EAA1B;;AACA,QAAMC,MAAM,GAAGT,QAAQ,CAACK,iBAAD,CAAvB;;AACAC,qBAAGI,aAAH,CAAiBT,eAAjB,EAAkCQ,MAAlC;AACD;;AAED,eAAeE,yBAAf,CACEZ,WADF,EAEEC,QAFF,EAGE;AACA,QAAMC,eAAe,GAAGC,wBAAcC,KAAd,CAAoBS,iBAApB,CAAsCb,WAAtC,CAAxB;;AACA,QAAMM,iBAAiB,GAAGC,mBAAGC,YAAH,CAAgBN,eAAhB,EAAiCO,QAAjC,EAA1B;;AACA,QAAMC,MAAM,GAAGT,QAAQ,CAACK,iBAAD,CAAvB;;AACAC,qBAAGI,aAAH,CAAiBT,eAAjB,EAAkCQ,MAAlC;AACD;;AAED,eAAeI,0BAAf,CACEd,WADF,EAEEC,QAFF,EAKE;AACA,QAAMc,mBAAmB,GAAG,MAAMZ,wBAAcC,KAAd,CAAoBY,uBAApB,CAA4ChB,WAA5C,CAAlC;AACA,QAAMiB,mBAAmB,GAAG,MAAMd,wBAAce,QAAd,CAAuBC,wBAAvB,CAChCJ,mBADgC,CAAlC;AAGA,QAAML,MAAM,GAAG,MAAMT,QAAQ,CAACgB,mBAAD,CAA7B;AACA,QAAMd,wBAAce,QAAd,CAAuBE,yBAAvB,CAAiDL,mBAAjD,EAAsEL,MAAtE,CAAN;AACD;;AAED,eAAeW,uBAAf,CACErB,WADF,EAEEC,QAFF,EAGE;AACA,QAAMqB,YAAY,GAAG,MAAMnB,wBAAcC,KAAd,CAAoBmB,oBAApB,CAAyCvB,WAAzC,CAA3B;;AACA,QAAMwB,QAAQ,GAAGjB,mBAAGC,YAAH,CAAgBc,YAAY,CAACG,IAA7B,EAAmChB,QAAnC,EAAjB;;AACA,QAAMC,MAAM,GAAG,MAAMT,QAAQ,CAAC;AAAEuB,IAAAA,QAAF;AAAYE,IAAAA,QAAQ,EAAEJ,YAAY,CAACI;AAAnC,GAAD,CAA7B;;AACAnB,qBAAGI,aAAH,CAAiBW,YAAY,CAACG,IAA9B,EAAoCf,MAApC;AACD;;AAEc,eAAeiB,4BAAf,CAA4C3B,WAA5C,EAAiE;AAC9E;AACA,QAAM,+CAAsBA,WAAtB,CAAN;AAEA,QAAM;AAAE4B,IAAAA;AAAF,MAAU,yBAAU5B,WAAV,EAAuB;AAAE6B,IAAAA,yBAAyB,EAAE;AAA7B,GAAvB,CAAhB;AACA,QAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAR,CAAYC,kBAAZ,KAAmC,MAAMC,mBAAYC,uBAAZ,EAAzC,CAAjB;AAEA,QAAMpC,sBAAsB,CAACC,WAAD,EAAeoC,WAAD,IAAyB;AACjEA,IAAAA,WAAW,GAAGjC,wBAAckC,cAAd,CAA6BC,YAA7B,CAA0CV,GAA1C,EAA+CQ,WAA/C,CAAd;AACA,WAAOA,WAAP;AACD,GAH2B,CAA5B;AAKA,QAAMxB,yBAAyB,CAACZ,WAAD,EAAeoC,WAAD,IAAyB;AACpEA,IAAAA,WAAW,GAAGjC,wBAAckC,cAAd,CAA6BE,WAA7B,CAAyCX,GAAzC,EAA8CQ,WAA9C,CAAd;AACAA,IAAAA,WAAW,GAAGjC,wBAAcqC,OAAd,CAAsBC,uBAAtB,CAA8Cb,GAA9C,EAAmDQ,WAAnD,CAAd;AACAA,IAAAA,WAAW,GAAGjC,wBAAcuC,OAAd,CAAsBC,cAAtB,CAAqCf,GAArC,EAA0CQ,WAA1C,CAAd;AACAA,IAAAA,WAAW,GAAGjC,wBAAcuC,OAAd,CAAsBE,cAAtB,CAAqChB,GAArC,EAA0CQ,WAA1C,CAAd;AACA,WAAOA,WAAP;AACD,GAN8B,CAA/B;AAQA,QAAMtB,0BAA0B,CAACd,WAAD,EAAc,MAAM6C,eAAN,IAAyB;AACrEA,IAAAA,eAAe,GAAG,MAAM1C,wBAAcqC,OAAd,CAAsBM,2BAAtB,CAAkDlB,GAAlD,EAAuDiB,eAAvD,CAAxB;AACAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAc4C,WAAd,CAA0BC,cAA1B,CAAyCpB,GAAzC,EAA8CiB,eAA9C,CAAxB;AACAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAc8C,MAAd,CAAqBC,SAArB,CAA+BtB,GAA/B,EAAoCiB,eAApC,CAAxB;AACAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAcgD,WAAd,CAA0BC,qBAA1B,CAAgDxB,GAAhD,EAAqDiB,eAArD,CAAxB;AACAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAckD,WAAd,CAA0BC,qBAA1B,CAAgD1B,GAAhD,EAAqDiB,eAArD,CAAxB;AACAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAcoD,MAAd,CAAqBC,eAArB,CAAqC5B,GAArC,EAA0CiB,eAA1C,CAAxB;AACAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAcsD,QAAd,CAAuBC,iBAAvB,CAAyC9B,GAAzC,EAA8CiB,eAA9C,CAAxB;AACAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAcwD,kBAAd,CAAiCC,wBAAjC,CACtBhC,GADsB,EAEtBiB,eAFsB,CAAxB;AAKAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAc0D,eAAd,CAA8BC,wBAA9B,CACtBlC,GADsB,EAEtBiB,eAFsB,CAAxB;AAIAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAc4D,gBAAd,CAA+BC,mBAA/B,CACtBpC,GADsB,EAEtBiB,eAFsB,CAAxB;AAKAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAc8D,aAAd,CAA4BC,uBAA5B,CACtBtC,GADsB,EAEtBiB,eAFsB,CAAxB;AAKAA,IAAAA,eAAe,GAAG,MAAM1C,wBAAcgE,OAAd,CAAsBC,gBAAtB,CAAuCxC,GAAvC,EAA4CiB,eAA5C,EAA6Df,QAA7D,CAAxB;AAEA,WAAOe,eAAP;AACD,GA9B+B,CAAhC;AAgCA,QAAMxB,uBAAuB,CAACrB,WAAD,EAAc,OAAO;AAAEwB,IAAAA,QAAF;AAAYE,IAAAA;AAAZ,GAAP,KAAkC;AAC3E,QAAIA,QAAQ,KAAK,MAAjB,EAAyB;AACvBF,MAAAA,QAAQ,GAAGrB,wBAAcwD,kBAAd,CAAiCU,qCAAjC,CACTzC,GADS,EAETJ,QAFS,CAAX;AAID,KALD,MAKO;AACL8C,kCAAkBC,iBAAlB,CACE,oBADF,EAEG,8DAFH;AAID;;AACD,WAAO/C,QAAP;AACD,GAb4B,CAA7B,CApD8E,CAmE9E;;AACA,QAAMrB,wBAAcqC,OAAd,CAAsBgC,mBAAtB,CAA0C5C,GAA1C,EAA+C5B,WAA/C,CAAN,CApE8E,CAsE9E;;AACA,QAAMG,wBAAcsE,uBAAd,CAAsCC,0BAAtC,CAAiE9C,GAAjE,EAAsE5B,WAAtE,CAAN;AACA,QAAMG,wBAAcwE,aAAd,CAA4BC,sBAA5B,CAAmDhD,GAAnD,EAAwD5B,WAAxD,CAAN;AACA,QAAMG,wBAAc0E,SAAd,CAAwBC,kBAAxB,CAA2ClD,GAA3C,EAAgD5B,WAAhD,CAAN;AACA,QAAMG,wBAAc4E,YAAd,CAA2BC,eAA3B,CAA2CpD,GAA3C,EAAgD5B,WAAhD,CAAN,CA1E8E,CA4E9E;;AACA,QAAMG,wBAAcsD,QAAd,CAAuBwB,sBAAvB,CAA8CrD,GAA9C,EAAmD5B,WAAnD,CAAN;AACA,QAAMG,wBAAc+E,IAAd,CAAmBC,OAAnB,CAA2BvD,GAA3B,EAAgC5B,WAAhC,CAAN,CA9E8E,CAgF9E;;AACA,QAAMG,wBAAckC,cAAd,CAA6B+C,qBAA7B,CAAmDxD,GAAnD,EAAwD5B,WAAxD,CAAN,CAjF8E,CAmF9E;;AACA,QAAMG,wBAAckF,YAAd,CAA2BC,oBAA3B,CAAgD1D,GAAhD,EAAqD5B,WAArD,CAAN;AACA,QAAMG,wBAAcoF,IAAd,CAAmBC,YAAnB,CAAgC5D,GAAhC,EAAqC5B,WAArC,CAAN;AACD","sourcesContent":["import { AndroidConfig, getConfig, WarningAggregator } from '@expo/config';\nimport { UserManager } from '@expo/xdl';\nimport fs from 'fs-extra';\n\nimport { getOrPromptForPackage } from '../eject/ConfigValidation';\n\nasync function modifyBuildGradleAsync(\n  projectRoot: string,\n  callback: (buildGradle: string) => string\n) {\n  const buildGradlePath = AndroidConfig.Paths.getAndroidBuildGradle(projectRoot);\n  const buildGradleString = fs.readFileSync(buildGradlePath).toString();\n  const result = callback(buildGradleString);\n  fs.writeFileSync(buildGradlePath, result);\n}\n\nasync function modifyAppBuildGradleAsync(\n  projectRoot: string,\n  callback: (buildGradle: string) => string\n) {\n  const buildGradlePath = AndroidConfig.Paths.getAppBuildGradle(projectRoot);\n  const buildGradleString = fs.readFileSync(buildGradlePath).toString();\n  const result = callback(buildGradleString);\n  fs.writeFileSync(buildGradlePath, result);\n}\n\nasync function modifyAndroidManifestAsync(\n  projectRoot: string,\n  callback: (\n    androidManifest: AndroidConfig.Manifest.AndroidManifest\n  ) => Promise<AndroidConfig.Manifest.AndroidManifest>\n) {\n  const androidManifestPath = await AndroidConfig.Paths.getAndroidManifestAsync(projectRoot);\n  const androidManifestJSON = await AndroidConfig.Manifest.readAndroidManifestAsync(\n    androidManifestPath\n  );\n  const result = await callback(androidManifestJSON);\n  await AndroidConfig.Manifest.writeAndroidManifestAsync(androidManifestPath, result);\n}\n\nasync function modifyMainActivityAsync(\n  projectRoot: string,\n  callback: (props: { contents: string; language: 'java' | 'kt' }) => Promise<string>\n) {\n  const mainActivity = await AndroidConfig.Paths.getMainActivityAsync(projectRoot);\n  const contents = fs.readFileSync(mainActivity.path).toString();\n  const result = await callback({ contents, language: mainActivity.language });\n  fs.writeFileSync(mainActivity.path, result);\n}\n\nexport default async function configureAndroidProjectAsync(projectRoot: string) {\n  // Check package before reading the config because it may mutate the config if the user is prompted to define it.\n  await getOrPromptForPackage(projectRoot);\n\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  const username = process.env.EAS_BUILD_USERNAME || (await UserManager.getCurrentUsernameAsync());\n\n  await modifyBuildGradleAsync(projectRoot, (buildGradle: string) => {\n    buildGradle = AndroidConfig.GoogleServices.setClassPath(exp, buildGradle);\n    return buildGradle;\n  });\n\n  await modifyAppBuildGradleAsync(projectRoot, (buildGradle: string) => {\n    buildGradle = AndroidConfig.GoogleServices.applyPlugin(exp, buildGradle);\n    buildGradle = AndroidConfig.Package.setPackageInBuildGradle(exp, buildGradle);\n    buildGradle = AndroidConfig.Version.setVersionCode(exp, buildGradle);\n    buildGradle = AndroidConfig.Version.setVersionName(exp, buildGradle);\n    return buildGradle;\n  });\n\n  await modifyAndroidManifestAsync(projectRoot, async androidManifest => {\n    androidManifest = await AndroidConfig.Package.setPackageInAndroidManifest(exp, androidManifest);\n    androidManifest = await AndroidConfig.AllowBackup.setAllowBackup(exp, androidManifest);\n    androidManifest = await AndroidConfig.Scheme.setScheme(exp, androidManifest);\n    androidManifest = await AndroidConfig.Orientation.setAndroidOrientation(exp, androidManifest);\n    androidManifest = await AndroidConfig.Permissions.setAndroidPermissions(exp, androidManifest);\n    androidManifest = await AndroidConfig.Branch.setBranchApiKey(exp, androidManifest);\n    androidManifest = await AndroidConfig.Facebook.setFacebookConfig(exp, androidManifest);\n    androidManifest = await AndroidConfig.UserInterfaceStyle.setUiModeAndroidManifest(\n      exp,\n      androidManifest\n    );\n\n    androidManifest = await AndroidConfig.GoogleMobileAds.setGoogleMobileAdsConfig(\n      exp,\n      androidManifest\n    );\n    androidManifest = await AndroidConfig.GoogleMapsApiKey.setGoogleMapsApiKey(\n      exp,\n      androidManifest\n    );\n\n    androidManifest = await AndroidConfig.IntentFilters.setAndroidIntentFilters(\n      exp,\n      androidManifest\n    );\n\n    androidManifest = await AndroidConfig.Updates.setUpdatesConfig(exp, androidManifest, username);\n\n    return androidManifest;\n  });\n\n  await modifyMainActivityAsync(projectRoot, async ({ contents, language }) => {\n    if (language === 'java') {\n      contents = AndroidConfig.UserInterfaceStyle.addOnConfigurationChangedMainActivity(\n        exp,\n        contents\n      );\n    } else {\n      WarningAggregator.addWarningAndroid(\n        'userInterfaceStyle',\n        `Cannot automatically configure MainActivity if it's not java`\n      );\n    }\n    return contents;\n  });\n\n  // If we renamed the package, we should also move it around and rename it in source files\n  await AndroidConfig.Package.renamePackageOnDisk(exp, projectRoot);\n\n  // Modify colors.xml and styles.xml\n  await AndroidConfig.RootViewBackgroundColor.setRootViewBackgroundColor(exp, projectRoot);\n  await AndroidConfig.NavigationBar.setNavigationBarConfig(exp, projectRoot);\n  await AndroidConfig.StatusBar.setStatusBarConfig(exp, projectRoot);\n  await AndroidConfig.PrimaryColor.setPrimaryColor(exp, projectRoot);\n\n  // Modify strings.xml\n  await AndroidConfig.Facebook.setFacebookAppIdString(exp, projectRoot);\n  await AndroidConfig.Name.setName(exp, projectRoot);\n\n  // add google-services.json to project\n  await AndroidConfig.GoogleServices.setGoogleServicesFile(exp, projectRoot);\n\n  // TODOs\n  await AndroidConfig.SplashScreen.setSplashScreenAsync(exp, projectRoot);\n  await AndroidConfig.Icon.setIconAsync(exp, projectRoot);\n}\n"],"file":"configureAndroidProjectAsync.js"}